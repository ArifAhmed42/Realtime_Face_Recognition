# Realtime_Face_Recognition

## IT WORKS IN 3 STEPS
1. Face Detection and Data Gathering
2. Train the Recognizer
3. Face Recognition

Make sure you have OpenCV3 installed on your system.

Now......
1. Create a directory named "dataset" in the code directory.

2. Run "python capture.py" it will capture 30 photos in the dataset directory. This will capture the video stream that will be generated by the Camera, displaying both, in BGR color and Gray mode. ** Have to be careful about the directory**
To finish the program, you must press the key [ESC] on your keyboard.

Some makers found issues when trying to open the camera ( "Assertion failed" error messages). That could happen if the camera was not enabled during OpenCv installation and so, camera drivers did not install correctly.

The most basic task on Face Recognition is of course, "Face Detecting". Before anything, you must "capture" a face in order to recognize it, when compared with a new face captured on future.

The most common way to detect a face (or any objects), is using the "Haar Cascade classifier"

Object Detection using Haar feature-based cascade classifiers is an effective object detection method proposed by Paul Viola and Michael Jones in their paper, "Rapid Object Detection using a Boosted Cascade of Simple Features" in 2001. It is a machine learning based approach where a cascade function is trained from a lot of positive and negative images. It is then used to detect objects in other images.

Here we will work with face detection. Initially, the algorithm needs a lot of positive images (images of faces) and negative images (images without faces) to train the classifier. Then we need to extract features from it. The good news is that OpenCV comes with a trainer as well as a detector. If you want to train your own classifier for any object like car, planes etc. you can use OpenCV to create one. Its full details are given here: Cascade Classifier Training.

If you do not want to create your own classifier, OpenCV already contains many pre-trained classifiers for face, eyes, smile, etc. Those XML files can be download from haarcascades directory.

for each one of the captured frames, we should save it as a file on a "dataset" directory with a user ID.
For example, for a user with a face_id = 1, the 4th sample file on dataset/ directory will be something like: User.1.4.jpg

as shown in the above photo from my Pi. On my code, I am capturing 30 samples from each id. You can change it on the last "elif". The number of samples is used to break the loop where the face samples are captured.

3. Then run "python face_train.py" which will extract info from the dataset by processing those images and generate a dictionary file "trainer.yml".
On this second phase, we must take all user data from our dataset and "trainer" the OpenCV Recognizer. This is done directly by a specific OpenCV function. The result will be a .yml file that will be saved on the code directory.

**Confirm if you have the PIL library installed on your Rpi. 
If not, run the below command in Terminal:

pip install pillow

We will use as a recognizer, the LBPH (LOCAL BINARY PATTERNS HISTOGRAMS) Face Recognizer, included on OpenCV package. We do this in the following line:

recognizer = cv2.face.LBPHFaceRecognizer_create()

4. Run "python face_recg.py" . A window will open and start to recognize faces with name and confidence level.

We are including here a new array, so we will display "names", instead of numbered ids:

names = ['None', 'Arif', 'Hosnee', 'Zakaria Sir', 'Col Malik Sir', 'W']

So, for example: Arif will have the user with id = 1; Hosnee: id=2, etc.

Next, we will detect a face, same we did before with the haasCascade classifier. Having a detected face we can call the most important function in the above code:

id, confidence = recognizer.predict(gray portion of the face)
The recognizer.predict (), will take as a parameter a captured portion of the face to be analyzed and will return its probable owner, indicating its id and how much confidence the recognizer is in relation with this match.

Note that the confidence index will return "zero" if it will be cosidered a perfect match
And at last, if the recognizer could predict a face, we put a text over the image with the probable id and how much is the "probability" in % that the match is correct ("probability" = 60 - confidence index). If not, an "unknow" label is put on the face.

**MAKE SURE THE CLASSIFIER IS IN THE CODE DIRECTORY**
(that must be in a directory named "Cascades/", under your project directory).
